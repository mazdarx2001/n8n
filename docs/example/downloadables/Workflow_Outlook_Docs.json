{
  "meta": {
    "instanceId": "eb73f4ffdc88a336ed06723651bb7b7abb2d020a5b45cd3b91150b837f59c98c"
  },
  "nodes": [
    {
      "parameters": {
        "resource": "folderMessage",
        "operation": "getAll",
        "folderId": "={{Object.values($json)[0]}}",
        "additionalFields": {
          "filter": "isRead eq false"
        }
      },
      "name": "Get unread messages",
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 1,
      "position": [
        1160,
        480
      ],
      "id": "23a77cf1-9f71-40e9-9ae9-f5417fe76421",
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "11",
          "name": "Microsoft Outlook DocDemo"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "operation": "update",
        "messageId": "={{ $json[\"id\"] }}",
        "updateFields": {
          "isRead": true
        }
      },
      "name": "Mark message as read",
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 1,
      "position": [
        1320,
        200
      ],
      "id": "9c2c6467-e6f4-4d89-ba81-6045a7ac63e6",
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "11",
          "name": "Microsoft Outlook DocDemo"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "interval": 10
      },
      "name": "Interval",
      "type": "n8n-nodes-base.interval",
      "typeVersion": 1,
      "position": [
        120,
        580
      ],
      "id": "88cf517a-035c-4bf1-993d-12133ee5ba6c"
    },
    {
      "parameters": {
        "label": "={{$node[\"Get Folder Name\"].json[\"name\"]}}",
        "doc_type": "INVOICE",
        "importtype": "email",
        "address": "={{$node[\"Get unread messages\"].json[\"sender\"][\"emailAddress\"][\"address\"]}}",
        "inbox": "={{Object.keys($node[\"FunctionItem\"].json)[0]}}",
        "sub_org": "fcb1d623-1953-4f4a-8309-b3506b65933c"
      },
      "id": "30d39327-c9a8-4ed7-ad95-8da701d73dc5",
      "name": "Upload Document",
      "type": "n8n-nodes-base.upload",
      "typeVersion": 1,
      "position": [
        1780,
        480
      ],
      "alwaysOutputData": false,
      "credentials": {
        "Doc2AppApi": {
          "id": "12",
          "name": "Doc2App"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "resource": "messageAttachment",
        "operation": "getAll",
        "messageId": "={{ $json[\"id\"] }}",
        "additionalFields": {}
      },
      "id": "589491a9-182a-4b14-bfa9-30af3365fc69",
      "name": "Get Attachments",
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 1,
      "position": [
        1360,
        480
      ],
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "11",
          "name": "Microsoft Outlook DocDemo"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "resource": "messageAttachment",
        "operation": "download",
        "messageId": "={{ $node[\"Get unread messages\"].json[\"id\"] }}",
        "attachmentId": "={{$json[\"id\"]}}"
      },
      "id": "1a6c6c83-a29a-483e-9ee1-74141af17339",
      "name": "Download Attachment",
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 1,
      "position": [
        1580,
        480
      ],
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "11",
          "name": "Microsoft Outlook DocDemo"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "functionCode": "checker = {\n  '101_Kostenrechnung':'',\n  '102_Wareneingangrechnung':''\n}\nmapping = {}\n\nitem = $node[\"Microsoft getFolders\"].json\n\nif (item.displayName in checker) {\n  mapping[item.displayName]=item.id\n}\n\nreturn mapping;"
      },
      "id": "27a256b1-b2a7-4616-a29c-95e331cd7ad9",
      "name": "FunctionItem",
      "type": "n8n-nodes-base.functionItem",
      "typeVersion": 1,
      "position": [
        500,
        580
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json}}",
              "operation": "isNotEmpty"
            }
          ]
        }
      },
      "id": "c1835878-1d80-4a84-9c11-9bba82b23262",
      "name": "IF",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        700,
        580
      ]
    },
    {
      "parameters": {
        "resource": "folder",
        "operation": "getAll",
        "additionalFields": {}
      },
      "id": "0d534627-6ed8-40f6-a72f-4e96386be0e9",
      "name": "Microsoft getFolders",
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 1,
      "position": [
        300,
        580
      ],
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "11",
          "name": "Microsoft Outlook DocDemo"
        }
      }
    },
    {
      "parameters": {
        "batchSize": 1,
        "options": {}
      },
      "id": "857d2847-44ff-48a0-a458-e3cad5420826",
      "name": "SplitInBatches",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 1,
      "position": [
        920,
        480
      ]
    }
  ],
  "connections": {
    "Get unread messages": {
      "main": [
        [
          {
            "node": "Mark message as read",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Attachments",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Interval": {
      "main": [
        [
          {
            "node": "Microsoft getFolders",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload Document": {
      "main": [
        [
          {
            "node": "SplitInBatches",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Attachments": {
      "main": [
        [
          {
            "node": "Download Attachment",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download Attachment": {
      "main": [
        [
          {
            "node": "Upload Document",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "FunctionItem": {
      "main": [
        [
          {
            "node": "IF",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF": {
      "main": [
        [
          {
            "node": "SplitInBatches",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Microsoft getFolders": {
      "main": [
        [
          {
            "node": "FunctionItem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SplitInBatches": {
      "main": [
        [
          {
            "node": "Get unread messages",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}
